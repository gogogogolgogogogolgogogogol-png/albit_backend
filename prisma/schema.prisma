datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum TransactionType {
    DEPOSIT
    WITHDRAW
    SWAP
    REINVEST
    DIVIDENDS
    BONUS
}

enum TransactionToken {
    ALB
    ALT
    USDT
}

enum TransactionStatus {
    FROZEN
    PENDING
    COMPLETED
    // FAILED
}

enum Lang {
    RU
    EN
    HI
    ES
}

model User {
    id         Int      @id @default(autoincrement())
    createdAt  DateTime @default(now())
    lang       Lang     @default(EN)
    username String?
    firstName String
    lastName String?
    isNewbie Boolean @default(true)
    wallet     Wallet?
    referrerId Int?
    referrer   User?    @relation("UserReferrals", fields: [referrerId], references: [id], onDelete: SetNull)
    referrals  User[]   @relation("UserReferrals")
    isFrozen   Boolean  @default(false)
    tgId       String   @unique
}

model Wallet {
    id                 Int           @id @default(autoincrement())
    userId             Int           @unique
    address            String
    gasFreeAddress String
    isActivated Boolean @default(false)
    privateKey         String
    alb_balance        Float         @default(0)
    locked_alb_balance Float         @default(0)
    alt_balance        Float         @default(0)
    locked_alt_balance Float         @default(0)
    alt_dividends Float @default(0)
    withdrawAddress    String?
    transactions       Transaction[]
    user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt          DateTime      @default(now())
}

model Transaction {
    id            Int               @id @default(autoincrement())
    walletId      Int
    wallet        Wallet            @relation(fields: [walletId], references: [id], onDelete: Cascade)
    hash          String?
    type          TransactionType
    status TransactionStatus
    feeUsdt Float?
    ref_lvl       Int?
    alb_alt_rate  Float?
    alt_usdt_rate Float?
    from_token    TransactionToken?
    from_amount   Float?
    isLocked      Boolean           @default(false)
    lockedUntil   DateTime?
    to_token      TransactionToken
    to_amount     Float
    createdAt     DateTime          @default(now())
}

model Settings {
    id                             Int   @id @default(autoincrement())
    // REFERRAL
    ref_lvl1_bonus_deposit_percent Float @default(6)
    ref_lvl1_bonus_percent         Float @default(6) // percent
    ref_lvl2_bonus_percent         Float @default(5)
    ref_lvl3_bonus_percent         Float @default(4)
    ref_lvl4_bonus_percent         Float @default(3)
    ref_lvl5_bonus_percent         Float @default(2)

    ref_lvl1_bonus_min_alb Float @default(10)
    ref_lvl2_bonus_min_alb Float @default(20)
    ref_lvl3_bonus_min_alb Float @default(50)
    ref_lvl4_bonus_min_alb Float @default(80)
    ref_lvl5_bonus_min_alb Float @default(100)

    // INCOME
    future_daily_income_alb_percent Float @default(0.8)
    daily_income_alb_percent Float @default(0.8)

    // SWAP
    min_swap_alt_amount Float @default(10)
    min_swap_alb_amount Float @default(10)
    alt_usdt_rate       Float @default(1) // 1 -> value, ex. 1 ALT -> 0.92 USDT
    alb_alt_rate        Float @default(8.75) // 1 -> value

    // DEPOSIT AND WITHDRAW
    deposit_fee_usdt  Float @default(2)
    deposit_min_amount   Float @default(100) // USDT
    withdraw_fee_usdt Float @default(3)
    withdraw_min_amount  Float @default(100) // ALT

    // COOLDOWN DURATION
    reinvest_cooldown_days Int @default(1)
    alt_alb_cooldown_days       Int @default(3)
    alb_alt_cooldown_days       Int @default(30)

    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}
